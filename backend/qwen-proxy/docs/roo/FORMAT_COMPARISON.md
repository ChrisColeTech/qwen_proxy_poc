# OpenAI vs Roo-Cline Request Format Comparison

## Side-by-Side Comparison

### OpenAI Function Calling Format (NOT USED by Roo-Cline)

```json
{
  "model": "gpt-4",
  "messages": [
    {
      "role": "system",
      "content": "You are a helpful assistant."
    },
    {
      "role": "user",
      "content": "What files are in the current directory?"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "list_files",
        "description": "List files in a directory",
        "parameters": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "description": "Directory path"
            }
          },
          "required": ["path"]
        }
      }
    }
  ],
  "tool_choice": "auto"
}
```

**Response with Tool Call:**
```json
{
  "role": "assistant",
  "content": null,
  "tool_calls": [
    {
      "id": "call_abc123",
      "type": "function",
      "function": {
        "name": "list_files",
        "arguments": "{\"path\":\".\"}"
      }
    }
  ]
}
```

### Roo-Cline Format (ACTUAL FORMAT)

```json
{
  "model": "qwen3-max",
  "temperature": 0,
  "stream": true,
  "stream_options": {
    "include_usage": true
  },
  "messages": [
    {
      "role": "system",
      "content": "You are Roo, a highly skilled software engineer...\n\n[20KB of tool definitions in XML format]\n\n## list_files\nDescription: Request to list files...\n\nUsage:\n<list_files>\n<path>Directory path here</path>\n</list_files>"
    },
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "<task>\nWhat files are in the current directory?\n</task>"
        },
        {
          "type": "text",
          "text": "<environment_details>\n# VSCode Visible Files\n...\n</environment_details>"
        }
      ]
    }
  ]
}
```

**Response with Tool Call:**
```json
{
  "role": "assistant",
  "content": "I'll list the files in the current directory.\n\n<list_files>\n<path>.</path>\n</list_files>"
}
```

## Key Differences Table

| Feature | OpenAI Format | Roo-Cline Format |
|---------|--------------|------------------|
| **Tools Definition** | Separate `tools` array with JSON Schema | Embedded in system prompt as text/XML |
| **Tool Schema Format** | JSON Schema objects | Human-readable XML examples |
| **System Prompt Size** | Usually < 1KB | ~20KB (includes all tool docs) |
| **User Message Type** | String | Array of content objects |
| **User Message Tags** | None | `<task>` and `<environment_details>` |
| **Assistant Tool Calls** | `tool_calls` array field | Embedded in `content` as XML |
| **Tool Call ID** | Generated by API | Not used |
| **Tool Call Format** | JSON object with `name` and `arguments` | XML tags with parameters |
| **Temperature** | Variable (0-2) | Always 0 |
| **Streaming** | Optional | Always enabled |
| **Stream Usage Stats** | Optional | Always included |
| **Tool Choice** | `auto`, `none`, specific | Not specified (implicit) |
| **Multimodal Content** | Optional | Always used for user messages |

## Message Structure Comparison

### OpenAI: Simple String Message
```json
{
  "role": "user",
  "content": "List files in src/"
}
```

### Roo-Cline: Content Array with Tags
```json
{
  "role": "user",
  "content": [
    {
      "type": "text",
      "text": "<task>\nList files in src/\n</task>"
    },
    {
      "type": "text",
      "text": "<environment_details>\n# VSCode Visible Files\nsrc/app.js\n\n# Current Time\n2025-10-29T20:00:00Z\n</environment_details>"
    }
  ]
}
```

## Tool Definition Comparison

### OpenAI: JSON Schema
```json
{
  "type": "function",
  "function": {
    "name": "read_file",
    "description": "Read file contents",
    "parameters": {
      "type": "object",
      "properties": {
        "path": {
          "type": "string",
          "description": "File path"
        }
      },
      "required": ["path"]
    }
  }
}
```

### Roo-Cline: XML in System Prompt
```text
## read_file
Description: Request to read the contents of one or more files.

Parameters:
- path: (required) File path (relative to workspace directory)

Usage:
<read_file>
<args>
  <file>
    <path>path/to/file</path>
  </file>
</args>
</read_file>

Example:
<read_file>
<args>
  <file>
    <path>src/app.ts</path>
  </file>
</args>
</read_file>
```

## Tool Invocation Comparison

### OpenAI Response
```json
{
  "role": "assistant",
  "content": "I'll read the file for you.",
  "tool_calls": [
    {
      "id": "call_xyz",
      "type": "function",
      "function": {
        "name": "read_file",
        "arguments": "{\"path\":\"src/app.ts\"}"
      }
    }
  ]
}
```

### Roo-Cline Response
```json
{
  "role": "assistant",
  "content": "I'll read the file for you.\n\n<read_file>\n<args>\n  <file>\n    <path>src/app.ts</path>\n  </file>\n</args>\n</read_file>"
}
```

## Conversation Flow Comparison

### OpenAI Conversation
```json
{
  "messages": [
    {"role": "system", "content": "Brief prompt"},
    {"role": "user", "content": "Do task"},
    {"role": "assistant", "content": "OK", "tool_calls": [...]},
    {"role": "tool", "tool_call_id": "call_123", "content": "Result"},
    {"role": "user", "content": "Next task"}
  ]
}
```

### Roo-Cline Conversation
```json
{
  "messages": [
    {"role": "system", "content": "20KB prompt"},
    {"role": "user", "content": [{"type": "text", "text": "<task>Do task</task>"}, ...]},
    {"role": "assistant", "content": "OK\n\n<tool>...</tool>"},
    {"role": "user", "content": [{"type": "text", "text": "[Tool Result] ..."}, ...]},
    {"role": "user", "content": [{"type": "text", "text": "<task>Next task</task>"}, ...]}
  ]
}
```

Note: Roo-Cline doesn't have a separate `tool` role - tool results come back as user messages!

## Why This Matters for the Proxy

### What the Proxy Needs to Handle

1. **Accept content arrays** - User messages with multimodal format
2. **Stream responses** - Always enabled
3. **Include usage stats** - In streaming chunks
4. **Large system prompts** - 20KB+ text
5. **NO tool parsing** - Don't try to extract/parse tool calls
6. **Message history** - Full conversation context each time

### What the Proxy Does NOT Need

1. **Tool schema validation** - Tools are in system prompt, not structured
2. **Tool call ID generation** - Not used
3. **Tool choice handling** - Not specified
4. **Function calling conversion** - Different paradigm entirely

## Testing Implications

### Wrong Test (OpenAI Format)
```javascript
// DON'T DO THIS
const request = {
  model: "qwen3-max",
  messages: [{role: "user", content: "Hello"}],
  tools: [{type: "function", function: {...}}],  // WRONG!
  tool_choice: "auto"  // WRONG!
};
```

### Correct Test (Roo-Cline Format)
```javascript
// DO THIS
const request = {
  model: "qwen3-max",
  temperature: 0,
  stream: true,
  stream_options: { include_usage: true },
  messages: [
    {
      role: "system",
      content: fs.readFileSync('./roo_system_prompt.txt', 'utf8')
    },
    {
      role: "user",
      content: [
        { type: "text", text: "<task>Hello</task>" },
        { type: "text", text: "<environment_details>...</environment_details>" }
      ]
    }
  ]
};
```

## Summary

**Roo-Cline and OpenAI use fundamentally different approaches:**

- **OpenAI**: Structured function calling with schema validation
- **Roo-Cline**: Prompt engineering with XML-formatted tool instructions

The proxy must handle the Roo-Cline format natively without trying to convert to/from OpenAI format!
