{
  "description": "SQLite-specific templates for infrastructure files (database, middleware, app.ts)",
  "database_type": "sqlite",
  "templates": {
    "database": {
      "path": "src/utils/database.ts",
      "template": "/*\n * ‚ö†Ô∏è  WARNING: GENERATED CODE - DO NOT MODIFY ‚ö†Ô∏è\n * \n * This file is automatically generated by the backend code generator.\n * Any manual changes will be overwritten when the generator runs.\n * \n * To make changes, modify the generator configuration files in:\n * /tools/backend-tools/backend-generator-v2/\n * \n * Then re-run the generator to update this file.\n */\n\nimport Database from 'better-sqlite3';\nimport { randomBytes } from 'node:crypto';\n\n// Get database path from environment or use default\nconst DB_PATH = process.env.DB_PATH || './llm-api-vault.db';\n\n// Initialize database connection\nexport const db = new Database(DB_PATH);\n\n// Enable WAL mode for better concurrency\ndb.pragma('journal_mode = WAL');\n\nconsole.log(`‚úÖ Database connected: ${DB_PATH}`);\n\n/**\n * Initialize database schema\n * Creates tables and indexes if they don't exist\n */\nexport function initializeDatabase(tableDefinitions: { [key: string]: string }): void {\n  try {\n    // Create tables from definitions\n    for (const [tableName, createStatement] of Object.entries(tableDefinitions)) {\n      db.exec(createStatement);\n      console.log(`‚úÖ Table initialized: ${tableName}`);\n    }\n    \n    console.log('‚úÖ Database schema initialized successfully');\n  } catch (error) {\n    console.error('‚ùå Database initialization failed:', error);\n    throw error;\n  }\n}\n\n/**\n * Generate unique ID\n * Format: 16 random hex characters\n */\nexport function generateId(): string {\n  return randomBytes(8).toString('hex');\n}\n\n/**\n * Get current timestamp in ISO format\n */\nexport function getCurrentTimestamp(): string {\n  return new Date().toISOString();\n}\n\n/**\n * Convert snake_case to camelCase for database row transformation\n */\nexport function snakeToCamel(str: string): string {\n  return str.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());\n}\n\n/**\n * Convert camelCase to snake_case for database column names\n */\nexport function camelToSnake(str: string): string {\n  return str.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`);\n}\n\nexport default db;"
    },

    "auth_middleware": {
      "path": "src/middleware/auth.ts",
      "template": "/*\n * ‚ö†Ô∏è  WARNING: GENERATED CODE - DO NOT MODIFY ‚ö†Ô∏è\n * \n * This file is automatically generated by the backend code generator.\n * Any manual changes will be overwritten when the generator runs.\n * \n * To make changes, modify the generator configuration files in:\n * /tools/backend-tools/backend-generator-v2/\n * \n * Then re-run the generator to update this file.\n */\n\nimport { Request, Response, NextFunction } from 'express';\n\nexport interface AuthenticatedRequest extends Request {\n  user?: {\n    id: string;\n    [key: string]: any;\n  };\n  userId?: string;\n}\n\n/**\n * Basic authentication middleware\n * Can be extended based on your authentication strategy\n */\nexport const authenticate = (req: AuthenticatedRequest, res: Response, next: NextFunction) => {\n  console.log(`üîê Auth middleware: Processing authentication for ${req.method} ${req.path}`);\n  \n  // TODO: Implement your authentication logic here\n  // For now, this is a pass-through\n  console.log('‚ÑπÔ∏è  Authentication not implemented, allowing request');\n  \n  next();\n};\n\nexport const optionalAuth = (req: AuthenticatedRequest, res: Response, next: NextFunction) => {\n  console.log(`üîê Optional auth middleware: Processing for ${req.method} ${req.path}`);\n  \n  // TODO: Implement your optional authentication logic here\n  console.log('‚ÑπÔ∏è  Optional authentication not implemented, continuing without auth');\n  \n  next();\n};"
    },

    "validation_middleware": {
      "path": "src/middleware/validation.ts",
      "template": "/*\n * ‚ö†Ô∏è  WARNING: GENERATED CODE - DO NOT MODIFY ‚ö†Ô∏è\n * \n * This file is automatically generated by the backend code generator.\n * Any manual changes will be overwritten when the generator runs.\n * \n * To make changes, modify the generator configuration files in:\n * /tools/backend-tools/backend-generator-v2/\n * \n * Then re-run the generator to update this file.\n */\n\nimport { Request, Response, NextFunction } from 'express';\n\n/**\n * Basic validation middleware\n * Can be extended with validation libraries like Zod, Joi, or express-validator\n */\nexport const validate = (req: Request, res: Response, next: NextFunction) => {\n  // Basic validation placeholder\n  next();\n};\n\nexport const validateSchema = (schema: any) => {\n  return (req: Request, res: Response, next: NextFunction) => {\n    // Schema validation placeholder\n    next();\n  };\n};"
    },

    "swagger_setup": {
      "path": "src/config/swagger.ts",
      "template": "/*\n * ‚ö†Ô∏è  WARNING: GENERATED CODE - DO NOT MODIFY ‚ö†Ô∏è\n * \n * This file is automatically generated by the backend code generator.\n * Any manual changes will be overwritten when the generator runs.\n * \n * To make changes, modify the generator configuration files in:\n * /tools/backend-tools/backend-generator-v2/\n * \n * Then re-run the generator to update this file.\n */\n\nimport swaggerJsdoc from 'swagger-jsdoc';\nimport swaggerUi from 'swagger-ui-express';\nimport { Express } from 'express';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nconst options: swaggerJsdoc.Options = {\n  definition: {\n    openapi: '3.0.0',\n    info: {\n      title: 'Generated Backend API',\n      description: 'API documentation generated by Backend Generator v2',\n      version: '1.0.0',\n    },\n    servers: [\n      {\n        url: 'http://localhost:3001',\n        description: 'Development server',\n      },\n    ],\n  },\n  apis: ['./src/routes/*.ts'],\n};\n\n// Try to load pre-generated swagger.json if available\nlet swaggerSpec;\ntry {\n  const swaggerPath = path.join(process.cwd(), 'swagger.json');\n  if (fs.existsSync(swaggerPath)) {\n    swaggerSpec = JSON.parse(fs.readFileSync(swaggerPath, 'utf8'));\n    console.log('üìñ Loaded pre-generated swagger specification');\n  } else {\n    swaggerSpec = swaggerJsdoc(options);\n    console.log('üìñ Generated swagger specification from JSDoc');\n  }\n} catch (error: any) {\n  console.warn('‚ö†Ô∏è  Failed to load swagger spec, falling back to JSDoc:', error.message);\n  swaggerSpec = swaggerJsdoc(options);\n}\n\nexport const setupSwagger = (app: Express): void => {\n  app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerSpec, {\n    customCss: '.swagger-ui .topbar { display: none }',\n    customSiteTitle: 'Generated Backend API Documentation',\n    swaggerOptions: {\n      persistAuthorization: true,\n    },\n  }));\n  \n  app.get('/api-docs.json', (req, res) => {\n    res.setHeader('Content-Type', 'application/json');\n    res.send(swaggerSpec);\n  });\n  \n  console.log('üìñ Swagger documentation available at /api-docs');\n  console.log('üìÑ Raw OpenAPI spec available at /api-docs.json');\n};\n\nexport { swaggerSpec };"
    },

    "app_template": {
      "path": "src/app.ts",
      "template": "/*\n * ‚ö†Ô∏è  WARNING: GENERATED CODE - DO NOT MODIFY ‚ö†Ô∏è\n * \n * This file is automatically generated by the backend code generator.\n * Any manual changes will be overwritten when the generator runs.\n * \n * To make changes, modify the generator configuration files in:\n * /tools/backend-tools/backend-generator-v2/\n * \n * Then re-run the generator to update this file.\n */\n\nimport express from 'express';\nimport cors from 'cors';\nimport { setupSwagger } from './config/swagger';\nimport { initializeDatabase } from './utils/database';\n\nconst app = express();\nconst PORT = process.env.PORT || 3001;\nconst HOST = process.env.HOST || 'localhost';\n\n// Middleware\napp.use(cors());\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\n// Request logging middleware\napp.use((req, res, next) => {\n  console.log(`üì• ${new Date().toISOString()} - ${req.method} ${req.path}`);\n  next();\n});\n\n// Root route redirect to Swagger documentation\napp.get('/', (req, res) => {\n  res.redirect('/api-docs');\n});\n\n// Health check endpoint\napp.get('/health', (req, res) => {\n  res.json({ status: 'OK', timestamp: new Date().toISOString() });\n});\n\n// Setup Swagger documentation\nsetupSwagger(app);\n\n// Import route handlers\n{ROUTE_IMPORTS}\n\n// Register API routes\n{ROUTE_REGISTRATIONS}\n\n// Error handling middleware\napp.use((err: any, req: express.Request, res: express.Response, next: express.NextFunction) => {\n  console.error('‚ùå Internal Error:', err);\n  console.error('   Stack:', err.stack);\n  res.status(500).json({ error: 'Internal server error', message: err.message });\n});\n\n// 404 handler\napp.use('*', (req, res) => {\n  res.status(404).json({ error: 'Route not found' });\n});\n\n// Initialize database schema\nconst tableDefinitions = {SCHEMA_DEFINITIONS};\ninitializeDatabase(tableDefinitions);\n\n// Start server if this is the main module (ES module equivalent of require.main === module)\nconst isMainModule = import.meta.url === `file://${process.argv[1]}`;\nif (isMainModule) {\n  app.listen(PORT, HOST as string, () => {\n    console.log(`üöÄ Server running on http://${HOST}:${PORT}`);\n    console.log(`üìñ API Documentation: http://${HOST}:${PORT}/api-docs`);\n  });\n}\n\nexport default app;"
    },

    "package_dependencies": {
      "path": "package.json.template",
      "template": "{\n  \"name\": \"generated-backend\",\n  \"version\": \"1.0.0\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"dev\": \"tsx watch src/app.ts\",\n    \"build\": \"tsc\",\n    \"start\": \"node dist/app.js\"\n  },\n  \"dependencies\": {\n    \"express\": \"^4.18.2\",\n    \"cors\": \"^2.8.5\",\n    \"better-sqlite3\": \"^9.2.2\",\n    \"swagger-jsdoc\": \"^6.2.8\",\n    \"swagger-ui-express\": \"^4.6.3\"\n  },\n  \"devDependencies\": {\n    \"@types/express\": \"^4.17.21\",\n    \"@types/cors\": \"^2.8.17\",\n    \"@types/better-sqlite3\": \"^7.6.8\",\n    \"@types/node\": \"^20.10.6\",\n    \"@types/swagger-jsdoc\": \"^6.0.1\",\n    \"@types/swagger-ui-express\": \"^4.1.3\",\n    \"typescript\": \"^5.3.3\",\n    \"tsx\": \"^4.7.0\"\n  }\n}"
    },

    "route_template": {
      "template": "/*\n * ‚ö†Ô∏è  WARNING: GENERATED CODE - DO NOT MODIFY ‚ö†Ô∏è\n * \n * This file is automatically generated by the backend code generator.\n * Any manual changes will be overwritten when the generator runs.\n * \n * To make changes, modify the generator configuration files in:\n * /tools/backend-tools/backend-generator-v2/\n * \n * Then re-run the generator to update this file.\n */\n\nimport { Router } from 'express';\nimport { authenticate } from '../middleware/auth';\nimport { validate } from '../middleware/validation';\nimport { {SERVICE_CLASS} } from '../services/{service_name}Service';\nimport { {MODEL_IMPORTS} } from '../models/{MODEL_NAME}';\n\nconst router = Router();\nconst {service_instance} = new {SERVICE_CLASS}();\n\n{ROUTE_METHODS}\n\nexport default router;",

      "route_method_template": "// {METHOD} {PATH}\nrouter.{method}('{path}', {auth_middleware}(req: any, res) => {\n  try {\n    const result = {service_instance}.{handler}({parameters});\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    res.status(400).json({ success: false, error: error.message });\n  }\n});"
    },

    "model_template": {
      "template": "/*\n * ‚ö†Ô∏è  WARNING: GENERATED CODE - DO NOT MODIFY ‚ö†Ô∏è\n * \n * This file is automatically generated by the backend code generator.\n * Any manual changes will be overwritten when the generator runs.\n * \n * To make changes, modify the generator configuration files in:\n * /tools/backend-tools/backend-generator-v2/\n * \n * Then re-run the generator to update this file.\n */\n\nexport interface {ENTITY}Response {\n{RESPONSE_PROPERTIES}\n}\n\nexport interface Create{ENTITY}Request {\n{CREATE_PROPERTIES}\n}\n\nexport interface Update{ENTITY}Request {\n{UPDATE_PROPERTIES}\n}"
    },

    "service_template": {
      "template": "/*\n * ‚ö†Ô∏è  WARNING: GENERATED CODE - DO NOT MODIFY ‚ö†Ô∏è\n * \n * This file is automatically generated by the backend code generator.\n * Any manual changes will be overwritten when the generator runs.\n * \n * To make changes, modify the generator configuration files in:\n * /tools/backend-tools/backend-generator-v2/\n * \n * Then re-run the generator to update this file.\n */\n\nimport db, { generateId, getCurrentTimestamp, snakeToCamel } from '../utils/database';\nimport { {MODEL_IMPORTS} } from '../models/{MODEL_NAME}';\n\nexport class {SERVICE_CLASS} {\n{SERVICE_METHODS}\n}"
    }
  }
}
